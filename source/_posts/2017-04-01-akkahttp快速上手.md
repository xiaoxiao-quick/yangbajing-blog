title: Akka Http快速上手
tags:
  - scala
  - akka
  - akka http
category:
  - scala
  - akka
date: 2017-04-01 09:53:50
---


Akka Http 是Akka社区提供的一个 Http服务端/客户端通用工具包，支持 Http 1.0/1.1标准及WebSocket，现在 Http 2的支持也在紧锣密鼓的实现中。

这篇文章将介绍Akka Http Server，我们将介绍Akka Http的常用功能模块及使用方式。Akka Http提供了一套强大、易用、易扩展的route dsl来构建路由。Akka Http Client因还不支持超时功能，现在不建议在产品中使用。

## 第一个服务

我们可以从官方提供的`HttpApp`特质开始，它提供了快捷的方式来启动一个Akka Http server。

```scala
class WebServer extends HttpApp {
  def route: Route =
    path("hello") {
      get {
        complete(HttpEntity(ContentTypes.`text/html(UTF-8)`, "<h1>Say hello to akka-http</h1>"))
      }
    }
}
```

`path("hello")`定义了一个HTTP访问路由，`get`代表这个路由提供了**GET**请示，而`complete`涵数允许我们提供响应结果来完成这个路由定义，这里我们返回了一段文本。Akka Http的路由看起来向**声明式**的，以一直新颖而又直观的方式来定义HTTP服务。

用户第一次接触这种涵数套涵数（又像树型结构）的代码方式可能不大习惯，其实我们可以换种方式来实现这段代码：

```scala
  def traditionRoute: Route = {
    val respResult = complete("result") // 响应结果
    val hPath = path("hello") // 绑定的HTTP访问路径
    hPath(get(result)) 
  }
```

`路径(Http方法(结果))`，我们用Java式的风格来实现同样的功能。这样是不是更符合你对代码的预期？

让我们的启动服务：

{% codeblock StartBoot01.scala lang:scala https://github.com/yangbajing/akka-action/blob/master/akka-http-starter/src/main/java/starter/akka/http/demo01/StartBoot01.scala StartBoot01.scala %}

object StartBoot {
  def main(args: Array[String]): Unit = {
    val server = new WebServer
    server.startServer("0.0.0.0", 8888)
  }
}
{% endcodeblock %}

通过**curl**命令来测试下我们的第一个Akka Http服务（-i选项可以打印HTTP响应头）：

```
curl -i http://localhost:8888/hello
HTTP/1.1 200 OK
Server: akka-http/10.0.5
Date: Fri, 31 Mar 2017 17:05:12 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 31

<h1>Say hello to akka-http</h1>
```

## Route

Akka Http 提供了一个灵活的**DSL**，它有很多可组合的元素（Directive 指令）以简洁、易读的方式来构建服务。
让我们来看下面这个示例：

```scala
get {
  pathSingleSlash {
    complete(HttpEntity(ContentTypes.`text/html(UTF-8)`,"<html><body>Hello world!</body></html>"))
  } ~
    path("ping") {
      complete("PONG!")
    } ~
    path("crash") {
      sys.error("BOOM!")
    }
}
```

通过嵌套和`~`操作符来组合指令定义路由结构时，将路由的定义看起来就像一个树

TODO 定义多个路由（不同Http Method，不同层级）

## TODO Route类型

## TODO Directive类型

## TODO 使用JSON格式，解析与序列化


