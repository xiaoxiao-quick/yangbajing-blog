title: Nginx负载均衡配置
date: 2015-11-20 13:02:32
categories: work
tags:
- nginx
- 负载均衡
---

在配置文件`http`段内定义`upstream`指令：

```
    upstream crawlerApi {
        server crawler-ali:7100;
        server crawler-ali:7101;
    }
```

`server`标识指令定义用于做负载均衡的Server列表。`server`标识可以定义附加参数，每个参数之间使用空格分隔。`crawler-ali`和端口改成你自己的。

- weight=number：设置当前Server的优先级权重，值越大越高。默认为1。
- max_fails=number：设置最大重试次数。
- fail_timeout=time：设置重试间隔时间，默认10秒。
- backup：设置当前Server为备份Server，当其它Server不可以时启用。
- down：标记当前Server不可用。

在需要配置负载均衡的`location`里定义代理使用：

```
    proxy_pass http://crawlerApi;
```

